```
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—
â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘
   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘
   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘
   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘
   â•šâ•â•   â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•šâ•â•â• â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•     â•šâ•â•
```

<div align="center">

**Regime-Aware Â· Multi-Model AI Consensus Â· Deterministic Receipts Â· Safety-First**

[![CI](https://img.shields.io/github/actions/workflow/status/rsemeah/TradeSwarm/ci.yml?branch=master&label=CI&style=flat-square&color=00ff88)](/.github/workflows/ci.yml)
[![CodeQL](https://img.shields.io/github/actions/workflow/status/rsemeah/TradeSwarm/codeql.yml?label=CodeQL&style=flat-square&color=00ff88)](/.github/workflows/codeql.yml)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.8-3178c6?style=flat-square&logo=typescript&logoColor=white)](https://www.typescriptlang.org/)
[![Next.js](https://img.shields.io/badge/Next.js-16-black?style=flat-square&logo=nextdotjs&logoColor=white)](https://nextjs.org/)
[![Supabase](https://img.shields.io/badge/Supabase-PostgreSQL-3ecf8e?style=flat-square&logo=supabase&logoColor=white)](https://supabase.com/)
[![Groq](https://img.shields.io/badge/LLM-Groq%20%7C%20Llama%203.3%2070B-f55036?style=flat-square)](https://groq.com/)
[![License](https://img.shields.io/badge/License-All%20Rights%20Reserved-red?style=flat-square)](./LICENSE)

*A paper-trading platform that puts a multi-agent AI deliberation council in front of every options trade â€” with a cryptographic audit trail to back it up.*

</div>

---

## What Is TradeSwarm?

TradeSwarm is a **regime-aware AI trading assistant** and paper-trading practice platform. Before recommending any options position, it:

1. **Scans** a curated 155-ticker universe for high-scoring credit and debit spread candidates
2. **Deliberates** across multiple LLMs in parallel to reach consensus
3. **Gates** every execution through hard safety rules (spread, volume, OI, slippage, earnings blackout)
4. **Stamps** a deterministic, SHA-256-linked receipt on every decision so replays match to the bit
5. **Blocks** live execution until empirical trade history satisfies institutional validation thresholds

> **Alpha Software.** Paper trading only. No live broker integration exists yet.

---

## Table of Contents

- [Architecture](#architecture)
- [Tech Stack](#tech-stack)
- [Core Engine](#core-engine)
  - [Trade Orchestration](#1-trade-orchestration)
  - [Multi-Model Deliberation](#2-multi-model-deliberation)
  - [Trust Scoring](#3-trust-scoring)
  - [Safety Gates](#4-safety-gates)
  - [Determinism & Replay](#5-determinism--replay)
  - [Regime Detection](#6-regime-detection)
- [Scanner](#scanner)
- [API Reference](#api-reference)
- [Database Schema](#database-schema)
- [Frontend](#frontend)
- [Environment Variables](#environment-variables)
- [Local Development](#local-development)
- [CI/CD & Governance](#cicd--governance)
- [Build Status](#build-status)

---

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLIENT  â”€  React 19 + Next.js 16 + Tailwind CSS 4                    â”‚
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ RadarScreen  â”‚  â”‚ TradesScreen â”‚  â”‚       MoneyScreen            â”‚  â”‚
â”‚  â”‚ (Themes/     â”‚  â”‚ (Candidates/ â”‚  â”‚ (Portfolio / Drawdown /      â”‚  â”‚
â”‚  â”‚  Watchlist)  â”‚  â”‚  Execution)  â”‚  â”‚  Weekly Win Rate)            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚  HTTP (Next.js API Routes)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API LAYER  â”€  /app/api/                                               â”‚
â”‚                                                                        â”‚
â”‚  /scan          /trade         /learn-why    /health    /internal/*    â”‚
â”‚  (Full scan  +  (preview /     (AI explain   (DB+LLM    (calibration,  â”‚
â”‚   caching)       simulate /     endpoint)    probe)      replay, ops)  â”‚
â”‚                  execute)                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CORE ENGINE  â”€  /lib/engine/                                          â”‚
â”‚                                                                        â”‚
â”‚  runCanonicalTrade()                                                   â”‚
â”‚    â”‚                                                                   â”‚
â”‚    â”œâ”€â–º buildMarketContext()   â”€â”€â”€â”€ Yahoo Finance (quote + chain)       â”‚
â”‚    â”œâ”€â–º detectRegime()         â”€â”€â”€â”€ SMA/RSI/ATR on 60-day history       â”‚
â”‚    â”œâ”€â–º runDeliberation()      â”€â”€â”€â”€ Groq LLaMA 3.3 70B (+ OpenAI opt)  â”‚
â”‚    â”‚     â””â”€â–º arbitrate()      â”€â”€â”€â”€ Conservative arbiter on split vote  â”‚
â”‚    â”œâ”€â–º computeTrustScore()    â”€â”€â”€â”€ 4-factor weighted scoring (0-100)   â”‚
â”‚    â”œâ”€â–º evaluateSafety()       â”€â”€â”€â”€ Hard-block gates (fail-closed)      â”‚
â”‚    â”œâ”€â–º persistMarketSnapshot()â”€â”€â”€â”€ SHA-256 content hash â†’ Supabase     â”‚
â”‚    â”œâ”€â–º enforceReplayPolicy()  â”€â”€â”€â”€ Institutional validation gates      â”‚
â”‚    â””â”€â–º writeReceipt()         â”€â”€â”€â”€ Immutable determinism_hash bundle   â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SCANNER       â”‚   SUPABASE (PostgreSQL)    â”‚   EXTERNAL SERVICES       â”‚
â”‚  /src/lib/     â”‚                            â”‚                           â”‚
â”‚  scanner/      â”‚  profiles                  â”‚  Yahoo Finance            â”‚
â”‚                â”‚  trades + receipts         â”‚  (quotes, options chain,  â”‚
â”‚  155 tickers   â”‚  market_snapshots          â”‚   60-day history)         â”‚
â”‚  PCS/CCS/CDS   â”‚  engine_events             â”‚                           â”‚
â”‚  candidates    â”‚  calibration_metrics       â”‚  Groq (Llama 3.3 70B)    â”‚
â”‚  Multi-factor  â”‚  trade_replay_reports      â”‚                           â”‚
â”‚  scoring       â”‚  scan_results              â”‚  TruthSerum (stub)        â”‚
â”‚  Stress tests  â”‚  learn_why_cache           â”‚  (fail-closed in exec)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Tech Stack

| Layer | Technology | Version |
|-------|-----------|---------|
| Framework | Next.js (App Router + Turbopack) | 16.1.6 |
| UI | React | 19.0.0 |
| Language | TypeScript (strict) | 5.8.2 |
| Styling | Tailwind CSS | 4.2.1 |
| AI SDK | Vercel AI SDK | 6.0.105 |
| Primary LLM | Groq Â· Llama 3.3 70B | â€” |
| Secondary LLM | OpenAI (optional) | â€” |
| Database | Supabase (PostgreSQL 16) | 2.49.1 |
| Auth | Supabase Auth + SSR | 0.8.0 |
| Schema Validation | Zod | 4.3.6 |
| Market Data | Yahoo Finance (free) | â€” |
| Dev Environment | Docker Compose (Postgres + TruthSerum) | â€” |
| Package Manager | pnpm | â€” |

---

## Core Engine

### 1. Trade Orchestration

**`lib/engine/runCanonicalTrade.ts`** is the single entry point for all trade routes. No short-circuits exist â€” every call passes through the full pipeline:

```
runCanonicalTrade(ticker, strategy, mode)
  â”‚
  â”œâ”€[1]â”€ buildMarketContext()       â†’ fetch live quote + options chain
  â”œâ”€[2]â”€ detectRegime()             â†’ classify market conditions
  â”œâ”€[3]â”€ runDeliberation()          â†’ parallel LLM council vote
  â”œâ”€[4]â”€ computeTrustScore()        â†’ 4-factor weighted score (0â€“100)
  â”œâ”€[5]â”€ evaluateSafety()           â†’ hard block gates
  â”œâ”€[6]â”€ persistMarketSnapshot()    â†’ store + SHA-256 hash
  â”œâ”€[7]â”€ enforceReplayPolicy()      â†’ institutional validation gates
  â””â”€[8]â”€ writeReceipt()             â†’ determinism_hash proof bundle
```

---

### 2. Multi-Model Deliberation

**`lib/engine/deliberation.ts`** runs a two-round AI council:

```
Round 1 â”€â”€â”€â”€ Parallel invocations â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   Groq / Llama 3.3  â”‚     â”‚  OpenAI (optional)  â”‚
  â”‚   (Primary judge)   â”‚     â”‚  (Secondary judge)  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚   decision: GO/WAIT/NO     â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
            consensusStrength < 1.0?
                            â”‚
Round 2 â”€â”€â”€â”€â”€â”€ Arbitration â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Arbitrator LLM                            â”‚
  â”‚  Conservative bias: prefers WAIT over GO   â”‚
  â”‚  on genuine disagreement                   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
              Final output: { decision, confidence,
                winLikelihood, recommendedAmount }
```

---

### 3. Trust Scoring

**`lib/engine/scoring.ts`** â€” 4-factor weighted score (returns 0â€“100 integer):

| Factor | Weight | Logic |
|--------|--------|-------|
| **Model Agreement** | 40% | Agreement ratio Ã— penalty (unanimous=1.0, 50/50 split=0.75) |
| **Provider Credibility** | 30% | Flat 0.8 baseline (will be calibrated empirically) |
| **Regime Alignment** | 20% | +0.2 if bullish/strong on GO Â· âˆ’0.2 if bearish |
| **Risk Penalty** | 10% | âˆ’0.3 extreme Â· âˆ’0.15 high Â· +0.05 low |

---

### 4. Safety Gates

**`lib/engine/safety.ts`** â€” hard-blocking rules. Any violation returns `blocked: true`:

```
âœ—  Bid-ask spread     > SAFETY_MAX_SPREAD_PCT         (default 1%)
âœ—  Underlying volume  < SAFETY_MIN_UNDERLYING_VOLUME  (default 100,000)
âœ—  Option volume      < SAFETY_MIN_OPTION_VOLUME      (default 100)
âœ—  Open interest      < SAFETY_MIN_OPTION_OI          (default 200)
âœ—  Estimated slippage > SAFETY_MAX_SLIPPAGE_PCT       (default 0.5%)
âœ—  Earnings blackout    active (2 days before Â· 1 day after)
âœ—  TruthSerum          unavailable in execute mode    (fail-closed)
```

Size clipping is always applied regardless of block status:
```
maxSizeHint = min(bankroll Ã— SAFETY_MAX_SIZE_CAP_PCT, SAFETY_MAX_NOTIONAL_USD)
            = min(bankroll Ã— 5%, $25,000)
```

---

### 5. Determinism & Replay

Every receipt carries a cryptographic proof of reproducibility:

```typescript
// lib/engine/determinism.ts
hashDeterministic(value) â†’ SHA-256(stableStringify(value))
//                         â†‘ canonical JSON with sorted keys

// Stored on every receipt:
{
  market_snapshot_ref:  "uuid â†’ market_snapshots table",
  market_snapshot_hash: "sha256 of snapshot content",
  determinism_hash:     "sha256(inputs + snapshot + engine_config)",
  engine_version:       "ENGINE_VERSION env var"
}
```

**Institutional validation gates** block execution until these thresholds are met:

| Gate | Env Var | Default | Meaning |
|------|---------|---------|---------|
| Minimum trade history | `MIN_EMPIRICAL_TRADES` | 30 | Must have â‰¥30 logged trades |
| Receipt coverage | `REPLAY_COVERAGE_THRESHOLD` | 0% | % of trades with valid receipts |
| Mismatch tolerance | `REPLAY_MISMATCH_THRESHOLD` | 1 | Max allowed replay mismatch rate |
| Ruin probability | `MAX_RUIN_PROBABILITY` | 5% | Rolling drawdown ruin bound |
| Manual freeze | `system_controls.trade_engine_frozen` | â€” | Operator kill-switch in DB |

---

### 6. Regime Detection

**`lib/engine/regime.ts`** fetches 60 days of history from Yahoo Finance and classifies conditions:

```
Indicators computed:
  SMA20, SMA50          â†’ trend direction
  RSI14                 â†’ momentum
  ATR14                 â†’ volatility
  Price change %        â†’ short-term momentum
  Volume ratio          â†’ conviction

Output classification:
  trend:      bullish | bearish | neutral
  volatility: low | medium | high
  momentum:   strong | weak | neutral
  confidence: 0â€“1 (degrades on sparse data)

Fallback: neutral regime on any data failure (fail-safe)
```

---

## Scanner

**`src/lib/scanner/`** â€” full pipeline for surfacing ranked trade candidates:

### Universe
- **155 fixed tickers** organized by sector (avoids regime whiplash from dynamic lookups)
- Custom watchlists supported via `/api/watchlist`

### Candidate Generation

| Strategy | Description | Entry Delta | Width |
|----------|-------------|-------------|-------|
| **PCS** (Put Credit Spread) | Short put + long put below | 0.25â€“0.35 | 1â€“2 strikes |
| **CCS** (Call Credit Spread) | Short call + long call above | 0.25â€“0.35 | 1â€“2 strikes |
| **CDS** (Call Debit Spread) | Long call + short call above | 0.45â€“0.55 | 1â€“2 strikes |

DTE windows: **10â€“21 days**, **21â€“30 days** (catalyst mode adds **3â€“7** and **10â€“21**)

### Scoring Model (composite, 0â€“100)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Final Score = weighted sum of:                                      â”‚
â”‚                                                                      â”‚
â”‚   35%  ROR Score      â†’ Return on Risk Â· Kelly fraction             â”‚
â”‚   25%  POP Score      â†’ Probability of Profit (IV positioning)      â”‚
â”‚   20%  IV/RV Score    â†’ Implied vs Realized volatility spread       â”‚
â”‚   15%  Liquidity Score â†’ Bid-ask spread Â· Volume Â· OI               â”‚
â”‚    +   Event Penalty  â†’ Earnings / FOMC / CPI / NFP proximity       â”‚
â”‚    +   Regime Bonus   â†’ Market conditions + sentiment alignment      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Stress Testing
Each candidate runs a **Monte Carlo scenario analysis**:
- Â±1Ïƒ and Â±2Ïƒ price moves
- P&L ranges under each scenario
- Output stored on candidate as `stressResults`

### Caching
Results are cached **5 minutes** in-process per watchlist config. Force-refresh via `{ forceRefresh: true }` in request body.

---

## API Reference

### Public Routes

| Method | Endpoint | Description |
|--------|----------|-------------|
| `POST` | `/api/scan` | Run scanner. Returns ranked candidate list with scores, stress results, and caching metadata. |
| `GET` | `/api/scan/[scanId]` | Fetch a previously stored scan result by ID. |
| `POST` | `/api/trade` | Trade orchestrator. Accepts `mode: preview | simulate | execute`. |
| `POST` | `/api/trade/simulate` | Run Monte Carlo simulation on a candidate. |
| `POST` | `/api/learn-why` | AI-generated plain-language explanation of a decision. Cached in DB. |
| `GET/POST` | `/api/watchlist` | Get or update a user's custom ticker universe. |
| `GET` | `/api/health` | Probes DB, Groq, and OpenAI. Tests SPY, QQQ, NVDA for market data health. |

### Internal / Ops Routes

> Protected by `INTERNAL_JOBS_TOKEN` header.

| Method | Endpoint | Description |
|--------|----------|-------------|
| `GET` | `/api/internal/ops/calibration-metrics` | Brier scores, precision buckets, drift detection. |
| `GET` | `/api/internal/ops/validation-report` | Institutional validation snapshot + freeze recommendation. |
| `POST` | `/api/internal/ops/replay/[id]` | Replay a historical receipt and classify any mismatch. |
| `POST` | `/api/internal/jobs/outcome-tracker` | Mark trades as winner/loser for calibration. |
| `POST` | `/api/internal/jobs/recalibrate` | Recompute thresholds from historical outcomes. |

---

## Database Schema

Managed via SQL migrations in `scripts/` (001â€“008):

```
profiles                  â† Supabase auto-created, user identity
user_preferences          â† safety_mode, account settings
portfolio_stats           â† balance, drawdown_pct, trades_today, win_rate
watchlist                 â† user's custom ticker list

trades                    â† strategy, ticker, amount, outcome
trade_receipts            â† canonical proof bundles (determinism_hash, etc.)
market_snapshots          â† UUID-indexed snapshots + SHA-256 content hash
trade_replay_reports      â† replay analysis: match status, diff, classification

engine_events             â† full audit log of every engine decision
scan_results              â† scan run metadata + candidate counts
learn_why_cache           â† cached AI explanations (deduplicated)
calibration_metrics       â† Brier score, precision by confidence bucket
```

---

## Frontend

Three-screen layout with a persistent tab bar:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        TRADESWARM                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   RADAR      â”‚         TRADES             â”‚       MONEY          â”‚
â”‚              â”‚                            â”‚                      â”‚
â”‚  Market      â”‚  ScanControls              â”‚  Portfolio balance   â”‚
â”‚  Themes      â”‚  DealList (candidates)     â”‚  Drawdown buffer     â”‚
â”‚  (AI Infra,  â”‚  DealCard (per candidate)  â”‚  Daily P&L           â”‚
â”‚   Defense,   â”‚  ProofDrawer (audit trail) â”‚  Weekly win rate     â”‚
â”‚   Energy)    â”‚  LearnWhyModal (AI explain)â”‚  Trade history       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Design system:** Dark terminal aesthetic
- Background: `#0a0a0a`
- Primary accent: `#00ff88` (neon green)
- Warning: `#ffcc00` Â· Danger: `#ff4444`
- Mobile-first (breakpoint: 420px)

**Demo mode:** Append `?demo=1` to any URL to use mock data (no API calls made).

---

## Environment Variables

```env
# â”€â”€ Required â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJ...
SUPABASE_SERVICE_ROLE_KEY=eyJ...
GROQ_API_KEY=gsk_...

# â”€â”€ LLM (optional second model) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
AI_GATEWAY_API_KEY=           # OpenAI via gateway
OPENAI_API_KEY=               # Direct OpenAI fallback

# â”€â”€ Internal route auth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
INTERNAL_JOBS_TOKEN=          # Bearer token for /api/internal/*

# â”€â”€ Safety thresholds â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SAFETY_MAX_SPREAD_PCT=1.0
SAFETY_MIN_UNDERLYING_VOLUME_24H=100000
SAFETY_MIN_OPTION_VOLUME_24H=100
SAFETY_MIN_OPTION_OI=200
SAFETY_MAX_SIZE_CAP_PCT=5
SAFETY_MAX_NOTIONAL_USD=25000
SAFETY_EARNINGS_BLACKOUT_BEFORE_DAYS=2
SAFETY_EARNINGS_BLACKOUT_AFTER_DAYS=1
SAFETY_MAX_SLIPPAGE_PCT=0.5

# â”€â”€ Institutional validation gates â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
MIN_EMPIRICAL_TRADES=30
REPLAY_COVERAGE_THRESHOLD=0
REPLAY_MISMATCH_THRESHOLD=1
MAX_RUIN_PROBABILITY=0.05

# â”€â”€ Engine metadata â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ENGINE_VERSION=unknown
TRUTH_SERUM_TIMEOUT_MS=500
```

---

## Local Development

### Prerequisites
- Node.js â‰¥ 20
- pnpm
- Docker (for local Postgres + TruthSerum stub)

### Setup

```bash
# 1. Clone and install
git clone https://github.com/rsemeah/TradeSwarm
cd TradeSwarm
pnpm install

# 2. Start local services (Postgres on :5432, TruthSerum stub on :8787)
docker compose up -d

# 3. Copy env template and fill in values
cp .env.example .env.local

# 4. Apply database migrations
psql postgresql://tradeswarm:tradeswarm@localhost:5432/tradeswarm \
  -f scripts/001_base_schema.sql \
  -f scripts/002_trades_and_receipts.sql \
  ... (through 008)

# 5. Start the dev server
pnpm dev
```

Open [http://localhost:3000](http://localhost:3000). Append `?demo=1` to skip live API calls.

### Useful Commands

```bash
pnpm dev          # Next.js dev server (Turbopack)
pnpm build        # Production build
pnpm start        # Serve production build
pnpm lint         # ESLint governance checks
pnpm typecheck    # TypeScript strict type check
```

---

## CI/CD & Governance

### Workflows

| Workflow | Trigger | Purpose |
|----------|---------|---------|
| `ci.yml` | Push / PR | Lint â†’ typecheck â†’ build (required gates) |
| `codeql.yml` | Push / Schedule | GitHub code security scanning |
| `codex-policy.yml` | PR | Codex automated PR policy review |
| `dependabot-auto-merge.yml` | Dependabot PR | Auto-merge labeled patch/minor deps |
| `block-unsafe.yml` | PR | Block dangerous operations |
| `self-heal.yml` | PR | Auto-fix governance issues |

### AGENTS.md Policy

**P0 (merge-blocking):**
- Safety wiring missing in any trade route
- Determinism hash not computed or not persisted
- Missing imports / unresolved modules / build breaks
- README claims non-existent files or workflows

**What Codex is authorized to do:**
- Fix build errors, stub missing modules, correct imports

**What Codex cannot do:**
- Change trading logic or safety evaluator behavior
- Remove or bypass the proof structure
- Disable CI gates

---

## Build Status

| Component | Status |
|-----------|--------|
| Canonical Trade Orchestrator | âœ… Implemented |
| Multi-Model Deliberation | âœ… Implemented |
| Trust Scoring (4-factor) | âœ… Implemented |
| Safety Evaluator (fail-closed) | âœ… Implemented |
| Determinism (SHA-256 hashing) | âœ… Implemented |
| Market Snapshot Persistence | âœ… Implemented |
| Deterministic Replay | âœ… Implemented |
| Regime Detection | âœ… Implemented |
| Full Scanner (PCS/CCS/CDS) | âœ… Implemented |
| RV20 Volatility Indicator | âœ… Implemented |
| Calibration Analytics | âœ… Implemented |
| Outcome Tracking | âœ… Implemented |
| Institutional Validation Gates | âœ… Implemented |
| Paper Trading | âœ… Implemented |
| News / Sentiment Module | ğŸ”¶ Stubbed (empty results) |
| Live Broker Integration | âŒ Not started |

---

## Repository Layout

```
TradeSwarm/
â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”œâ”€â”€ api/                      # All API route handlers
â”‚   â”‚   â”œâ”€â”€ scan/                 # Scanner endpoint
â”‚   â”‚   â”œâ”€â”€ trade/                # Trade orchestrator
â”‚   â”‚   â”œâ”€â”€ learn-why/            # AI explainer
â”‚   â”‚   â”œâ”€â”€ health/               # System health probe
â”‚   â”‚   â”œâ”€â”€ watchlist/            # Watchlist management
â”‚   â”‚   â””â”€â”€ internal/             # Ops + cron endpoints
â”‚   â””â”€â”€ auth/                     # Login / signup pages
â”œâ”€â”€ components/                   # React UI components
â”‚   â”œâ”€â”€ app.tsx                   # Root app + tab bar
â”‚   â”œâ”€â”€ radar-screen.tsx          # Market themes view
â”‚   â”œâ”€â”€ trades-screen.tsx         # Candidate evaluation
â”‚   â”œâ”€â”€ money-screen.tsx          # Portfolio stats
â”‚   â”œâ”€â”€ DealCard.tsx              # Candidate card
â”‚   â”œâ”€â”€ ProofDrawer.tsx           # Receipt inspector
â”‚   â””â”€â”€ learn-why-modal.tsx       # AI explanation modal
â”œâ”€â”€ lib/                          # Core engine
â”‚   â”œâ”€â”€ engine/                   # Orchestration, deliberation, safety
â”‚   â”œâ”€â”€ scanner/                  # Scanner (lib version)
â”‚   â”œâ”€â”€ calibration/              # Analytics + recalibration
â”‚   â”œâ”€â”€ adapters/                 # HTTP circuit breaker
â”‚   â”œâ”€â”€ receipts/                 # Receipt writing
â”‚   â”œâ”€â”€ supabase/                 # DB client + middleware
â”‚   â””â”€â”€ types/                    # TypeScript contracts
â”œâ”€â”€ src/lib/                      # v2 scanner (full implementation)
â”‚   â”œâ”€â”€ scanner/                  # Candidate generation + scoring
â”‚   â”œâ”€â”€ indicators/               # RV20, volatility
â”‚   â”œâ”€â”€ news/                     # News + calendar (stubbed)
â”‚   â”œâ”€â”€ adapters/                 # Yahoo Finance + safety
â”‚   â””â”€â”€ receipts/                 # Proof bundle writer
â”œâ”€â”€ scripts/                      # SQL migrations (001â€“008)
â”œâ”€â”€ docs/                         # Architecture documentation
â”œâ”€â”€ __tests__ / tests/            # Unit + integration tests
â”œâ”€â”€ supabase/                     # Supabase project config
â”œâ”€â”€ docker-compose.yml            # Local dev: Postgres + TruthSerum
â”œâ”€â”€ AGENTS.md                     # Repository policy contract
â””â”€â”€ public/                       # Static assets
```

---

<div align="center">

*All rights reserved. See [LICENSE](./LICENSE).*

</div>
